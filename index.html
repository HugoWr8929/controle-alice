<!DOCTYPE html>
<html lang="pt-br" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alice Ultimate ERP üçº v7.5</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <style>
        body { @apply bg-gray-50 text-gray-800 transition-all; }
        .card { @apply bg-white p-4 rounded-2xl shadow-sm border border-gray-100; }
        .input-style { @apply w-full border border-gray-200 rounded-xl p-2 text-sm bg-white; }
        .tab-btn { @apply flex-1 py-2 rounded-lg font-bold text-xs transition-all text-center; }
        .tab-active { @apply bg-pink-500 text-white shadow-md; }
        .tab-inactive { @apply bg-gray-200 text-gray-500; }
        .filter-btn { @apply px-3 py-1 rounded-full text-[10px] font-bold border transition-all; }
        .filter-active { @apply bg-gray-800 text-white border-gray-800; }
        .filter-inactive { @apply bg-white text-gray-400 border-gray-200; }
        .hidden { display: none !important; }
    </style>
</head>
<body class="pb-24">

    <div id="login-screen" class="fixed inset-0 z-[100] bg-pink-600 flex items-center justify-center p-4">
        <div class="bg-white p-8 rounded-3xl shadow-2xl w-full max-w-md">
            <div class="text-center mb-6">
                <span class="text-5xl">üë∂</span>
                <h2 class="text-2xl font-bold text-pink-600 mt-2">Alice ERP Login</h2>
            </div>
            <div class="space-y-4">
                <input type="email" id="login-email" placeholder="E-mail" class="input-style">
                <input type="password" id="login-password" placeholder="Senha" class="input-style">
                <button onclick="handleLogin()" class="w-full bg-pink-600 text-white py-3 rounded-xl font-bold">Entrar</button>
                <p id="login-error" class="text-red-500 text-xs text-center hidden"></p>
            </div>
        </div>
    </div>

    <div id="main-app" class="hidden">
        <nav class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b p-4">
            <div class="max-w-6xl mx-auto flex justify-between items-center">
                <h1 class="text-xl font-bold text-pink-600">Alice Ultimate</h1>
                <div class="flex gap-2 items-center">
                    <button onclick="toggleAvoMode()" id="avo-btn" class="text-[10px] bg-orange-100 text-orange-700 px-2 py-1 rounded font-bold uppercase">Av√≥s: OFF</button>
                    <button onclick="handleLogout()" class="text-xs text-gray-400 underline">Sair</button>
                </div>
            </div>
            <div class="max-w-6xl mx-auto flex gap-1 mt-4 overflow-x-auto">
                <button onclick="switchTab('estoque')" id="btn-estoque" class="tab-btn tab-active">üì¶ Estoque</button>
                <button onclick="switchTab('saude')" id="btn-saude" class="tab-btn tab-inactive">üè• Sa√∫de</button>
                <button onclick="switchTab('rotina')" id="btn-rotina" class="tab-btn tab-inactive">‚è∞ Rotina</button>
            </div>
        </nav>

        <main class="max-w-6xl mx-auto p-4 space-y-6">

            <div id="tab-estoque" class="tab-content space-y-4">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                    <div class="card bg-pink-500 text-white border-none text-center">
                        <p class="text-[10px] uppercase opacity-80">Falta Investir</p>
                        <p id="future-cost" class="text-lg font-bold">R$ 0</p>
                    </div>
                    <div class="card text-center border-l-4 border-l-blue-500">
                        <p class="text-[10px] text-gray-400 uppercase">M√©dia Real</p>
                        <p id="media-val" class="text-lg font-bold text-blue-500">--</p>
                    </div>
                    <div class="card text-center border-l-4 border-l-green-500">
                        <p class="text-[10px] text-gray-400 uppercase">Em Estoque</p>
                        <p id="stock-val" class="text-lg font-bold text-green-600">R$ 0</p>
                    </div>
                    <div class="card text-center">
                        <p class="text-[10px] text-gray-400 uppercase">Total Itens</p>
                        <p id="total-count" class="text-lg font-bold">0</p>
                    </div>
                </div>

                <button onclick="registerUsage()" class="w-full bg-blue-600 text-white font-black py-8 rounded-3xl shadow-lg active:scale-95 transition text-2xl uppercase">Troquei a Alice! üß∑</button>

                <div class="flex gap-2 justify-center mb-2">
                    <button onclick="setFilter('all')" id="filter-all" class="filter-btn filter-active">TUDO</button>
                    <button onclick="setFilter('fraldas')" id="filter-fraldas" class="filter-btn filter-inactive">FRALDAS</button>
                    <button onclick="setFilter('higiene')" id="filter-higiene" class="filter-btn filter-inactive">HIGIENE</button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="card">
                        <h2 class="font-bold mb-4 text-sm">üì• Lan√ßar Compra</h2>
                        <div class="space-y-3">
                            <select id="cat-input" class="input-style" onchange="toggleSizeInput()">
                                <option value="fralda">Fraldas</option>
                                <option value="lenco">Len√ßos</option>
                                <option value="pomada">Pomadas</option>
                                <option value="shampoo">Shampoo</option>
                                <option value="sabonete_liq">Sabonete L√≠q.</option>
                                <option value="sabonete_barra">Sabonete Barra</option>
                                <option value="condicionador">Condicionador</option>
                            </select>
                            <div id="size-wrapper">
                                <select id="size-input" class="input-style"><option>RN</option><option>P</option><option>M</option><option>G</option><option>XG</option></select>
                            </div>
                            <input type="number" id="qty-input" placeholder="Quantidade" class="input-style">
                            <button onclick="addItem()" class="w-full bg-pink-500 text-white py-2 rounded-xl font-bold">Salvar</button>
                        </div>
                    </div>
                    <div class="card">
                        <h2 class="font-bold mb-4 text-sm">‚ö†Ô∏è Alertas</h2>
                        <div id="alerts-list" class="space-y-1"></div>
                    </div>
                </div>

                <div class="card overflow-x-auto">
                    <table class="w-full text-xs">
                        <tbody id="main-table"></tbody>
                    </table>
                </div>
            </div>
            
            <div id="tab-saude" class="tab-content hidden"> <div class="card">Consulte a aba de Estoque para lan√ßar produtos.</div> </div>
            <div id="tab-rotina" class="tab-content hidden"> <div class="card text-center"><button onclick="regFeed('E')" class="bg-pink-100 p-4 rounded-xl m-2">ü§± ESQ</button><button onclick="regFeed('D')" class="bg-blue-100 p-4 rounded-xl m-2">ü§± DIR</button></div> </div>

        </main>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDxoVagw1NT72ywjK_svZeBt2beCowoZx8",
            authDomain: "alice-erp.firebaseapp.com",
            databaseURL: "https://alice-erp-default-rtdb.firebaseio.com",
            projectId: "alice-erp",
            storageBucket: "alice-erp.firebasestorage.app",
            messagingSenderId: "758898829901",
            appId: "1:758898829901:web:98125a74abcdf144930a04",
            measurementId: "G-64NHJVVMB6"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        const market = {
            fraldas: { 'RN': 200, 'P': 800, 'M': 1300, 'G': 1600, 'XG': 800 },
            higiene: { 'lenco': 120, 'pomada': 24, 'shampoo': 10, 'sabonete_liq': 15, 'sabonete_barra': 20, 'condicionador': 6 }
        };
        const prices = { fralda: 1.15, lenco: 12, pomada: 25, shampoo: 18, sabonete_liq: 24, sabonete_barra: 5, condicionador: 20 };
        const labels = { lenco: 'Len√ßos (pct)', pomada: 'Pomada (tubo)', shampoo: 'Shampoo', sabonete_liq: 'Sabonete L√≠q.', sabonete_barra: 'Sabonete Barra', condicionador: 'Condicionador' };

        let currentFilter = 'all';

        auth.onAuthStateChanged(user => {
            if(user) {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                startSync();
            } else {
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('main-app').classList.add('hidden');
            }
        });

        async function handleLogin() {
            const e = document.getElementById('login-email').value;
            const p = document.getElementById('login-password').value;
            try { await auth.signInWithEmailAndPassword(e, p); } catch(err) { alert(err.message); }
        }

        function handleLogout() { auth.signOut(); }

        function startSync() {
            db.ref().on('value', snap => {
                const data = snap.val() || {};
                renderEstoque(data.stock || {}, data.usageLogs || {});
            });
        }

        function setFilter(f) {
            currentFilter = f;
            document.querySelectorAll('.filter-btn').forEach(b => {
                b.classList.replace('filter-active', 'filter-inactive');
                if(b.id === 'filter-'+f) b.classList.replace('filter-inactive', 'filter-active');
            });
            db.ref().once('value', snap => renderEstoque(snap.val().stock || {}, snap.val().usageLogs || {}));
        }

        function renderEstoque(stock, logsObj) {
            const table = document.getElementById('main-table');
            const alerts = document.getElementById('alerts-list');
            let future = 0, current = 0, count = 0;
            table.innerHTML = ''; alerts.innerHTML = '';
            
            // L√ìGICA FRALDAS
            if(currentFilter === 'all' || currentFilter === 'fraldas') {
                for(let s in market.fraldas) {
                    const has = stock[s] || 0;
                    const gap = Math.max(0, market.fraldas[s] - has);
                    future += gap * prices.fralda;
                    current += has * prices.fralda;
                    count += has;
                    table.innerHTML += `<tr class="border-b"><td class="py-3 font-bold text-pink-500">Fralda ${s}</td><td>${has} un</td><td class="text-right text-gray-400">Faltam ${gap}</td></tr>`;
                    if(has > 0 && has < 50) alerts.innerHTML += `<div class="p-1 bg-red-50 text-red-600 rounded text-[10px] font-bold">‚ö†Ô∏è Fralda ${s} acabando!</div>`;
                }
            }

            // L√ìGICA HIGIENE
            if(currentFilter === 'all' || currentFilter === 'higiene') {
                for(let item in market.higiene) {
                    const has = stock[item] || 0;
                    const target = market.higiene[item];
                    const gap = Math.max(0, target - has);
                    const p = prices[item] || 0;
                    future += gap * p;
                    current += has * p;
                    count += has;
                    table.innerHTML += `<tr class="border-b bg-gray-50/30"><td class="py-3 font-bold text-blue-500">${labels[item] || item}</td><td>${has} un</td><td class="text-right text-gray-400">R$ ${(gap*p).toFixed(0)}</td></tr>`;
                }
            }

            // DASHBOARD
            const logs = Object.values(logsObj);
            if(logs.length > 1) {
                const d = Math.max(1, (new Date(logs[logs.length-1]) - new Date(logs[0]))/86400000);
                document.getElementById('media-val').innerText = (logs.length/d).toFixed(1)+'/d';
            }
            document.getElementById('future-cost').innerText = 'R$ '+future.toFixed(0);
            document.getElementById('stock-val').innerText = 'R$ '+current.toFixed(0);
            document.getElementById('total-count').innerText = count;
        }

        function registerUsage() { db.ref('usageLogs').push().set(new Date().toISOString()); }
        function addItem() {
            const cat = document.getElementById('cat-input').value;
            const key = cat === 'fralda' ? document.getElementById('size-input').value : cat;
            const qty = parseInt(document.getElementById('qty-input').value) || 0;
            db.ref('stock/'+key).transaction(c => (c||0) + qty);
            document.getElementById('qty-input').value = '';
        }
        function switchTab(t) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.getElementById('tab-'+t).classList.remove('hidden');
            document.querySelectorAll('.tab-btn').forEach(b => {
                b.classList.replace('tab-active', 'tab-inactive');
                if(b.id === 'btn-'+t) b.classList.replace('tab-inactive', 'tab-active');
            });
        }
        function toggleSizeInput() { document.getElementById('size-wrapper').classList.toggle('hidden', document.getElementById('cat-input').value !== 'fralda'); }
        function toggleAvoMode() { document.body.classList.toggle('text-xl'); }
    </script>
</body>
</html>
